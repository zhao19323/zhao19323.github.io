<!DOCTYPE html>
<html lang="en">
<head>
	<title></title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<link type="text/css" rel="stylesheet" href="main.css">
</head>
<body>
<script type="importmap">
	{
		"imports": {
			"three": "../build/three.module.js",
			"three/addons/": "./jsm/"
		}
	}
</script>

<script type="module">

	import * as THREE from 'three';

	import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
	import { PCDLoader } from 'three/addons/loaders/PCDLoader.js';
	import { GUI } from 'three/addons/libs/lil-gui.module.min.js';

	let camera, scene, renderer;
	const color3 = new THREE.Color("rgb(24, 255, 0)");

	init();
	render();

	function init() {

		renderer = new THREE.WebGLRenderer( { antialias: true } );
		renderer.setPixelRatio( window.devicePixelRatio );
		renderer.setSize( window.innerWidth, window.innerHeight );
		//renderer.setClearColor(color3);
		document.body.appendChild( renderer.domElement );

		scene = new THREE.Scene();

		camera = new THREE.PerspectiveCamera( 2, window.innerWidth / window.innerHeight, 0.01, 400 );
		camera.position.set( -20, 0, 1 );
		scene.add( camera );
		scene.background = new THREE.Color( 0x000000 );



		const controls = new OrbitControls( camera, renderer.domElement );
		controls.addEventListener( 'change', render ); // use if there is no animation loop
		controls.minDistance = 0.5;
		controls.maxDistance = 10;
		//controls.enabled = false;//旋转


		//scene.add( new THREE.AxesHelper( 1 ) );

		const loader = new PCDLoader();
		loader.load( './models/pcd/binary/Zaghetto.pcd', function ( points ) {

			points.geometry.center();
			points.geometry.rotateX( Math.PI );
			//points.name = 'Zaghetto.pcd';
			//points.setAttribute(color3);
			points.material.color = new THREE.Color(0x97C89E);

			scene.add( points );

			//#529f5e

			//const gui = new GUI();

			//gui.add( points.material, 'size', 0.001, 0.01 ).onChange( render );
			//gui.addColor( points.material, 'color').onChange( render );
			//gui.addColor( points.material, 'color').onChange( render );

			//gui.open();



			render();

		} );

		window.addEventListener( 'resize', onWindowResize );

	}

	function onWindowResize() {

		camera.aspect = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();

		renderer.setSize( window.innerWidth, window.innerHeight );

		render();

	}

	function render() {

		renderer.render( scene, camera );

	}

</script>
</body>
</html>
<script>
	(function() {
		var ws = new WebSocket('ws://' + window.location.host +
			'/jb-server-page?reloadMode=RELOAD_ON_SAVE&'+
			'referrer=' + encodeURIComponent(window.location.pathname));
		ws.onmessage = function (msg) {
			if (msg.data === 'reload') {
				window.location.reload();
			}
			if (msg.data.startsWith('update-css ')) {
				var messageId = msg.data.substring(11);
				var links = document.getElementsByTagName('link');
				for (var i = 0; i < links.length; i++) {
					var link = links[i];
					if (link.rel !== 'stylesheet') continue;
					var clonedLink = link.cloneNode(true);
					var newHref = link.href.replace(/(&|\?)jbUpdateLinksId=\d+/, "$1jbUpdateLinksId=" + messageId);
					if (newHref !== link.href) {
						clonedLink.href = newHref;
					}
					else {
						var indexOfQuest = newHref.indexOf('?');
						if (indexOfQuest >= 0) {
							// to support ?foo#hash
							clonedLink.href = newHref.substring(0, indexOfQuest + 1) + 'jbUpdateLinksId=' + messageId + '&' +
								newHref.substring(indexOfQuest + 1);
						}
						else {
							clonedLink.href += '?' + 'jbUpdateLinksId=' + messageId;
						}
					}
					link.replaceWith(clonedLink);
				}
			}
		};
	})();
</script>
